---
title: "Simulation for the multi-site"
output:
  html_document: default
  pdf_document: default
---

Libraries
```{r warning=FALSE, message=FALSE}
library(ggplot2)
library(BayesFactor)
library(dplyr)
library(tidyverse)
library(readxl)
library(readr)
library(tidyr)
```

```{r warning=FALSE, message=FALSE}
set.seed(2)
```

I create the groups for the non-mindful active control condition,body scan, loving kindness, mindful movements, mindful breathing.
```{r warning=FALSE, message=FALSE}
control=rnorm(2500,2,1)
bs=rnorm(2500,1.8,1)
lk=rnorm(2500,1.8,1)
mm=rnorm(2500,1.8,1)
mb=rnorm(2500,1.8,1)
```

We verify that the ES is around 0.2 that is the smallest ES we want to detect. 
```{r warning=FALSE, message=FALSE}
mean(control)-mean(bs)
mean(control)-mean(lk)
mean(control)-mean(mm)
mean(control)-mean(mb)
```
To do the simulation:
\begin{enumerate}
\item I consider a sample of 500 (the N max we set for each group in the real experiment)
\item I set random seed from 1 to 500
\item For each random seed I compute the ttestBF in the four groups, random sampling 500 observations from that group
\item For each random seed I observe how many ttestBF reached the threeshold of 10
\end{enumerate}
In the 500 scenarios that we created we observe that with this sample size (500 participants for group) In the 0\% of cases each BF are below 10, in the 0.8\% of cases only one BF reaches 10, while in the '85.2% of cases at least three BF reaches 10.

```{r warning=FALSE, message=FALSE}
seed=seq(1,500,1)
size=500
a=crossing(seed,size)
S1=c()
S2=c()
S3=c()
S4=c()

for (i in 1:500){
  set.seed=as.numeric(a[i,1])
  S1[i]=extractBF(ttestBF(x=sample(control,as.numeric(a[i,2]),replace=F),
                          y=sample(bs,as.numeric(a[i,2]),replace=F),
                          paired=F,
                          nullInterval = c(0, Inf)))$bf[1]
  S2[i]=extractBF(ttestBF(x=sample(control,as.numeric(a[i,2]),replace=F),
                          y=sample(lk,as.numeric(a[i,2]),replace=F),
                          paired=F,
                          nullInterval = c(0, Inf)))$bf[1]
  S3[i]=extractBF(ttestBF(x=sample(control,as.numeric(a[i,2]),replace=F),
                          y=sample(mm,as.numeric(a[i,2]),replace=F),
                          paired=F,
                          nullInterval = c(0, Inf)))$bf[1]
  S4[i]=extractBF(ttestBF(x=sample(control,as.numeric(a[i,2]),replace=F),
                          y=sample(mb,as.numeric(a[i,2]),replace=F),
                          paired=F,
                          nullInterval = c(0, Inf)))$bf[1]
  
  
}
d=cbind(a,S1,S2,S3,S4)
d$C1=ifelse(S1>10,1,0)
d$C2=ifelse(S2>10,1,0)
d$C3=ifelse(S3>10,1,0)
d$C4=ifelse(S4>10,1,0)
d$SS=d$C1+d$C2+d$C3+d$C4



table(d$size,d$SS)/500
f=as.data.frame(table(d$size,d$SS)/500)
f$Var2=as.factor(f$Var2)


ggplot(f, aes(x=Var2, y=Freq)) +
  geom_segment( aes(x=Var2, xend=Var2, y=0, yend=Freq), color="skyblue") +
  geom_point( color="blue", size=4, alpha=0.6) +
  theme_light() +
  coord_flip() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.border = element_blank(),
    axis.ticks.y = element_blank()
  )+
  labs(x="",y="")
```




